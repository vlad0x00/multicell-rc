#!/usr/bin/env python3

import seaborn as sns
import matplotlib.pyplot as plt
import sys
import numpy as np
import pandas as pd
import math
import os
import ast
from . import params
sns.set(font_scale=1.1)

total_files = 0
valid_files = 0

data = { 'Accuracy' : [] }
for dirpath, dirnames, filenames in os.walk('results/'):
  for filename in filenames:
    if os.path.basename(filename).endswith('stdout'):
      total_files += 1
      with open(os.path.join(dirpath, filename), 'r') as f:
        args_found = False
        accuracy_found = False
        for line in f:
          if line.startswith('Args: '):
            argstring = ast.literal_eval(line.replace('Args: ', ''))
            args = params.parse_args(argstring)
            args_found = True
          if line.startswith('Testing accuracy:'):
            for arg in vars(args):
              argname = arg.replace('_', ' ').capitalize()
              argval = getattr(args, arg)
              if argname in data:
                data[argname].append(argval)
              else:
                data[argname] = [ argval ]
            data['Accuracy'].append(float(line.split()[2]))            
            accuracy_found = True

        if args_found and accuracy_found: valid_files += 1

print("Valid / total files: {} / {} ({}%)".format(valid_files, total_files, valid_files / total_files * 100))

data = pd.DataFrame(data)
data.to_csv('results.csv')